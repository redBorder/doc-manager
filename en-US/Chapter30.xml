<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "manual.ent">
<!ENTITY PRODUCT "Documentation">
<!ENTITY BOOKID "manual">
<!ENTITY YEAR "2023">
<!ENTITY HOLDER "Eneo TecnologÃ­a S.L. |">
]>

<chapter>
	<title>Uses Cases</title>
	<para>In this chapter we will show some uses cases of Redborder. Some of them: </para>
	<section>
		<title>Use Case: Tracking an IP with Redborder</title>
		<para>We can use Redborder to track a suspicious IP. Its possible to learn about its behaviour using Traffic module</para>
		<para>First of all we must know the ip we want to track. Once we have the IP we will go to Traffic module</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img001_a.png"/>
			</imageobject>
			<caption>
				<para>Tracking an IP: Traffic module</para>
			</caption>
		</mediaobject>
		<para>Once in Traffic module we can use the Advanced Search from Filter button to see only the traffic generated by that ip</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img001_b.png"/>
			</imageobject>
			<caption>
				<para>Tracking an IP: Advanced Search in Traffic module</para>
			</caption>
		</mediaobject>
		<para>Here we can set the suspicious ip to filter all the traffic. We will use LAN IP metric for that purpose.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img001_c.png"/>
			</imageobject>
			<caption>
				<para>Tracking an IP: Filtering IP</para>
			</caption>
		</mediaobject>
		<para>When we apply the filter we will see only the traffic for that ip.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img001_d.png"/>
			</imageobject>
			<caption>
				<para>Tracking an IP: Traffic filtered</para>
			</caption>
		</mediaobject>	
		<para>Is possible to add new metrics to see the behaviour of the ip and what is doing in our network.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img001_e.png"/>
			</imageobject>
			<caption>
				<para>Tracking an IP: Adding new metrics</para>
			</caption>
		</mediaobject>
		<para>Now we can see what ports are being used by this IP.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img001_f.png"/>
			</imageobject>
			<caption>
				<para>Tracking an IP: Ports being used by suspicious IP</para>
			</caption>
		</mediaobject>
		<para>With this use case we can see how Redborder is able to filter the traffic for one or more IP so the user can detect bad behaviours for particular ip's, being able to track ip's with only a few clicks.</para>
	</section>
	<section>
	<title>Use Case: Brute force authentication attack alert</title>
	<para>We can use Redborder to alert of possible brute force attacks thanks to the use of its correlation engine and the rules that are established.</para>
	<para>First, we must go to the Correlation Engine Rules section located in the Tools part.</para>
	<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img002_a.png"/>
			</imageobject>
			<caption>
				<para>CEP rules</para>
			</caption>
	</mediaobject>
	<para>Then we will activate the rule we want to use. In this case: SSH Brute Force Authentication. Finally, we must apply the changes.</para>
	<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img002_b.png"/>
			</imageobject>
			<caption>
				<para>CEP rules</para>
			</caption>
	</mediaobject>
	<para>This rule is capable of generating an alert when 200 unsuccessful log-in attempts occur in a 20 minute time window on a Linux machine via SSH protocol. For this, it is necessary to have the corresponding vault sensor created previously by referring to the IP of the machine which we want to protect.</para>
	<para>Once this is done, in case of receiving a brute force attack, we could visualize the corresponding alert by accessing the Vault module. To be able to view it easily, we can add a sensor tab and filter by CEP.</para>
	<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img002_c.png"/>
			</imageobject>
			<caption>
				<para>Vault module: Brute force attack alert.</para>
			</caption>
	</mediaobject>
	<para>We can also display the alert message if we switch to the message tab.</para>
	<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img002_d.png"/>
			</imageobject>
			<caption>
				<para>Vault module: Brute force attack alert message.</para>
			</caption>
	</mediaobject>
	<note>
			<title>Note</title>
			<para>To expand the use cases, we can access the following link where the advanced use cases are located:</para>
			<para><emphasis role="bold">https://support.redborder.com/hc/en-us/sections/360000254677-eXperience</emphasis></para>
	</note>
	</section>
	<section>
		<title>Use Case: Reviewing remote information from Untangle</title>
		<para>Redborder has the capability to collect information from other manufacturers and use it to monitorize remote systems.</para>
		<para>In this use case we will show how is possible to review a remote system status which is being monitorized by Untangle.</para>
		<para>First of all we will access to Vault module.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img003_a.png"/>
			</imageobject>
			<caption>
				<para>Vault module: General view</para>
			</caption>
		</mediaobject>
		<para>We will select Class metric from Untangle and will filter one of them</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img003_b.png"/>
			</imageobject>
			<caption>
				<para>Vault module: Untangle Class metric</para>
			</caption>
		</mediaobject>
		<para>Once we have filtered the Class, we will see the Hostname metric which are using the filtered class.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img003_c.png"/>
			</imageobject>
			<caption>
				<para>Vault module: Hostname view</para>
			</caption>
		</mediaobject>
		<para>We want to know which protocol is being used by the hostname and the class filtered.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img003_d.png"/>
			</imageobject>
			<caption>
				<para>Vault module: Filter view</para>
			</caption>
		</mediaobject>
		<para>Using the filter tool we can see that the protocol used by that particular hostname and that particular class is UDP.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img003_e.png"/>
			</imageobject>
			<caption>
				<para>Vault module: Protocolname view</para>
			</caption>
		</mediaobject>
	</section>
	<section>
		<title>Use Case: Detecting an Eternalblue attack with Redborder</title>
		<para>In this case we will see how Redborder can use Snort rules to detect an Eternalblue attack.</para>
		<para>All starts with a malicious pishing email which contains a dropper that installs a ransomware.</para>
		<para>The ramsomware will try to use a known exploit to take control of all possible machines</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img004_a.png"/>
			</imageobject>
			<caption>
				<para>Eternalblue attack: Scenary </para>
			</caption>
		</mediaobject>
		<para>Redborder can use Snort rules to detect the SMBv1 protocol echo response used by the ransomware, so we can use intrusion module to see the signatures to identify the attack.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img004_b.png"/>
			</imageobject>
			<caption>
				<para>Eternalblue attack: Intrusion</para>
			</caption>
		</mediaobject>
		<para>Here we can see the current signatures collected by Redborder.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img004_c.png"/>
			</imageobject>
			<caption>
				<para>Eternalblue attack: Filtering signature</para>
			</caption>
		</mediaobject>
		<para>Once we have filtered the Eternalblue signature we can show SRC Address metric to track IPs involved in the attack.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img004_d.png"/>
			</imageobject>
			<caption>
				<para>Eternalblue attack: Selecting SRC Address metric</para>
			</caption>
		</mediaobject>
		<para>Now we have the IPs of the machines involved so it is possible to take actions to solve the security hole.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img004_e.png"/>
			</imageobject>
			<caption>
				<para>Eternalblue attack: IPs involved in the attack</para>
			</caption>
		</mediaobject>
		<note>
				<title>Note</title>
				<para>It is important to have an updated version of Snort rules to detect weird behaviour and traffic with Redborder</para>
		</note>
	</section>
	<section>
		<title>Use Case: Ssh brute-force attacks </title>
		<para>In this case we want to protect and monitorize a critical ssh server, so we will use siddhi rules to track any kind of brute-force attack.</para>
		<para>Once we have the ssh server configured and we have already create a sensor for it in Redborder, we need to enable the Correlation Engine.</para>
		<para>To enable the Correlation Engine we have to introduce the following commands in the manager terminal.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img005_a.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: Enabling Correlation Engine</para>
			</caption>
		</mediaobject>
		<para>After that we will have to wait a few minutes to be ensured that cep is running. We can use rb_get_services.sh script to ensure that.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img005_b.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: Correlation Engine enabled</para>
			</caption>
		</mediaobject>
		<para>After that now we can go to Correlation Engine Rules from Tools menu.</para>
		<para>We will use Ssh brute-force siddhi rule.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img005_d.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: Ssh rules</para>
			</caption>
		</mediaobject>
		<para>We can see the rule clicking in the edit button on the right.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="350" fileref="images/ch30_img005_e.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: Editing ssh rule</para>
			</caption>
		</mediaobject>
		<para>We are going to change the maximum number of attempts to 3</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="350" fileref="images/ch30_img005_f.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: Edifint ssh rule</para>
			</caption>
		</mediaobject>
		<para>After that we must check the enable box of the rule and apply all the changes.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img005_g.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: Applying changes</para>
			</caption>
		</mediaobject>
		<para>In vault module we will see CEP sensor.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img005_h.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: CEP sensor</para>
			</caption>
		</mediaobject>
		<para>We can filter by CEP sensor to see the messages.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img005_i.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: CEP sensor filtered</para>
			</caption>
		</mediaobject>
		<para>In message tab we can see the messages from the cep sensor, which shows is alerting that a brute-force attack is being done.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch30_img005_i.png"/>
			</imageobject>
			<caption>
				<para>Ssh brute-force attack: CEP messages</para>
			</caption>
		</mediaobject>
		<note>
				<title>Note</title>
				<para>The correlation engine has a big potential due to siddhi rules. The default rules included in the manager can be edited to adapt it to your purposes or create new ones.</para>
		</note>
	</section>
</chapter>